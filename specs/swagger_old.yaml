openapi: 3.0.3
info:
  title: Sambur√° Core - API de Gerenciamento de Artefatos
  description: |
    Proxy de artefatos NPM com persist√™ncia em S3/MinIO e PostgreSQL.
    
    ## Autentica√ß√£o
    A maioria dos endpoints requer autentica√ß√£o via JWT Token ou API Key:
    - **Bearer Token**: Use `Authorization: Bearer <token>` para endpoints autenticados
    - **API Key**: Use `X-API-Key: <api_key>` para integra√ß√£o de sistemas
    
    ## Fluxo de Uso
    1. Registre um usu√°rio via `/api/v1/auth/register`
    2. Fa√ßa login via `/api/v1/auth/login` para obter o token JWT
    3. Crie uma API Key via `/api/v1/admin/api-keys` para upload automatizado
    4. Crie reposit√≥rios via `/api/v1/admin/repositories`
    5. Fa√ßa upload de artefatos via `/api/v1/upload` (POST/PUT)
    6. Consulte pacotes NPM via `/api/v1/npm/private-repo/{packageName}`
    7. Baixe artefatos diretamente pelos blobs
    
    ## Estrutura de Rotas Implementadas
    
    ### Rotas P√∫blicas (sem autentica√ß√£o obrigat√≥ria)
    - `/api/v1/auth/login` - Login e autentica√ß√£o
    - `/api/v1/system/*` - Health check e status do sistema
    
    ### Rotas Protegidas (requer autentica√ß√£o)
    - `/api/v1/auth/register` - Registro de novos usu√°rios (requer auth)
    - `/api/v1/admin/api-keys` - Gerenciamento de API Keys
    - `/api/v1/admin/repositories` - Gerenciamento de reposit√≥rios (n√£o conectado no router)
    - `/api/v1/admin/packages` - Listagem de pacotes (n√£o conectado no router)
    - `/api/v1/upload` - Upload de artefatos via multipart ou JSON (n√£o conectado no router)
    - `/api/v1/npm/*` - Metadados NPM e publish (n√£o conectado no router)
    
    **NOTA**: V√°rios controllers est√£o implementados mas n√£o conectados no MainRouter.
    
  version: 1.0.0
  contact:
    name: Sambur√° Core GitHub Repository
    url: https://github.com/sambura-artifacts/sambura_core

servers:
  - url: http://localhost:8080
    description: Servidor Local
  - url: https://dev.api.sambura.io
    description: Servidor de Desenvolvimento
  - url: https://hml.api.sambura.io
    description: Servidor de Homologa√ß√£o
  - url: https://api.sambura.io
    description: Servidor de Produ√ß√£o

tags:
  - name: Auth
    description: Autentica√ß√£o e registro de usu√°rios
  - name: System
    description: Health check e status do sistema
  - name: Admin - API Keys
    description: Gerenciamento de chaves de API (requer autentica√ß√£o)
  - name: Admin - Repositories
    description: Gerenciamento de reposit√≥rios (controller implementado, n√£o conectado)
  - name: Admin - Packages
    description: Listagem de pacotes (controller implementado, n√£o conectado)
  - name: NPM
    description: Endpoints compat√≠veis com NPM Registry (implementado, n√£o conectado)
  - name: Upload
    description: Upload de artefatos (controller implementado, n√£o conectado)
  - name: Artifacts
    description: Resolu√ß√£o e download de artefatos (controller implementado, n√£o conectado)
  - name: Blobs
    description: Download de blobs bin√°rios (controller implementado, n√£o conectado)

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Token JWT obtido via login
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API Key para integra√ß√£o de sistemas

  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
          description: Mensagem de erro
        message:
          type: string
          description: Descri√ß√£o detalhada
        instance:
          type: string
          description: Path da requisi√ß√£o
        
    Account:
      type: object
      properties:
        username:
          type: string
          example: "matheus"
        email:
          type: string
          format: email
          example: "matheus@sambura.io"
        password:
          type: string
          format: password
          example: "senha123"
        role:
          type: string
          enum: [admin, developer]
          default: developer
          
    LoginResponse:
      type: object
      properties:
        token:
          type: string
          description: Token JWT para autentica√ß√£o
        username:
          type: string
          description: Nome do usu√°rio
          
    Repository:
      type: object
      required:
        - name
        - namespace
      properties:
        id:
          type: integer
          description: ID do reposit√≥rio
        name:
          type: string
          example: "my-repo"
          description: Nome do reposit√≥rio
        namespace:
          type: string
          example: "@sambura"
          description: Namespace do reposit√≥rio
        is_public:
          type: boolean
          default: false
          description: Se o reposit√≥rio √© p√∫blico
        created_at:
          type: string
          format: date-time
          
    Package:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          example: "@sambura/core"
        repository_id:
          type: integer
        versions:
          type: array
          items:
            type: string
          example: ["1.0.0", "1.0.1", "1.1.0"]
          
    Artifact:
      type: object
      properties:
        external_id:
          type: string
          format: uuid
          description: UUID do artefato
        namespace:
          type: string
          example: "@sambura"
        package_name:
          type: string
          example: "core-lib"
        version:
          type: string
          example: "1.0.0"
        path:
          type: string
          example: "/libs/core-lib-1.0.0.tgz"
        repository_id:
          type: integer
        package_id:
          type: integer
        blob_id:
          type: integer
        created_at:
          type: string
          format: date-time
          
    ApiKey:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          example: "minha-chave-de-upload"
        prefix:
          type: string
          example: "smb_"
          description: Prefixo da chave
        api_key:
          type: string
          description: Chave completa (retornada apenas na cria√ß√£o)
        last_used_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
          
    NPMMetadata:
      type: object
      description: Metadados no formato do NPM Registry
      properties:
        name:
          type: string
        versions:
          type: object
          additionalProperties:
            type: object
        dist-tags:
          type: object
          additionalProperties:
            type: string

paths:
  # ===== AUTH =====
  /api/v1/auth/register:
    post:
      summary: Registra um novo usu√°rio
      description: |
        Cria uma nova conta no sistema.
        **NOTA**: Requer autentica√ß√£o (implementado com middleware requireAuth no MainRouter)
      tags:
        - Auth
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
                - email
              properties:
                username:
                  type: string
                  example: "matheus"
                password:
                  type: string
                  format: password
                  example: "senha123"
                email:
                  type: string
                  format: email
                  example: "matheus@sambura.io"
                role:
                  type: string
                  enum: [admin, developer]
                  default: developer
      responses:
        '200':
          description: Usu√°rio criado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Usu√°rio criado com sucesso, cria!"
        '401':
          description: N√£o autenticado
        '500':
          description: Erro no cadastro
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/auth/login:
    post:
      summary: Faz login no sistema
      description: |
        Autentica o usu√°rio e retorna um token JWT.
        Rota p√∫blica, n√£o requer autentica√ß√£o pr√©via.
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  example: "matheus"
                password:
                  type: string
                  format: password
                  example: "senha123"
      responses:
        '200':
          description: Login realizado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '403':
          description: Credenciais inv√°lidas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Erro no servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ===== SYSTEM - HEALTH CHECK =====
  /api/v1/system/health:
    get:
      summary: Verifica o status do sistema
      description: |
        Retorna informa√ß√µes sobre a sa√∫de do servidor e suas depend√™ncias.
        Rota p√∫blica, n√£o requer autentica√ß√£o.
      tags:
        - System
      responses:
        '200':
          description: Sistema operacional
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  timestamp:
                    type: string
                    format: date-time
        '500':
          description: Sistema com problemas

  # ===== ADMIN - API KEYS =====
  /api/v1/admin/repositories:
    get:
      summary: Lista todos os reposit√≥rios
      description: Retorna uma lista paginada de reposit√≥rios
      tags:
        - Admin - Repositories
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
          description: N√∫mero de itens por p√°gina
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Offset para pagina√ß√£o
      responses:
        '200':
          description: Lista de reposit√≥rios
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Repository'
                  total:
                    type: integer
                  limit:
                    type: integer
                  offset:
                    type: integer
        '401':
          description: N√£o autenticado
        '500':
          description: Erro no servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    
    post:
      summary: Cria um novo reposit√≥rio
      description: Cria um reposit√≥rio para armazenar pacotes
      tags:
        - Admin - Repositories
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - namespace
              properties:
                name:
                  type: string
                  example: "my-repo"
                namespace:
                  type: string
                  example: "@sambura"
                is_public:
                  type: boolean
                  default: false
      responses:
        '200':
          description: Reposit√≥rio criado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Repository'
        '400':
          description: Dados inv√°lidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: N√£o autenticado
        '500':
          description: Erro no servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ===== ADMIN - PACKAGES =====
  /api/v1/admin/packages:
    get:
      summary: Lista todos os pacotes do sistema
      description: Retorna uma lista global de todos os pacotes
      tags:
        - Admin - Packages
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: Lista de pacotes
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Package'
                  total:
                    type: integer
                  limit:
                    type: integer
                  offset:
                    type: integer
        '401':
          description: N√£o autenticado
        '500':
          description: Erro no servidor

  /api/v1/admin/repositories/{repoName}/packages:
    get:
      summary: Lista pacotes de um reposit√≥rio espec√≠fico
      description: Retorna todos os pacotes de um reposit√≥rio
      tags:
        - Admin - Packages
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: repoName
          in: path
          required: true
          schema:
            type: string
          description: Nome do reposit√≥rio
          example: "my-repo"
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: Lista de pacotes do reposit√≥rio
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Package'
        '401':
          description: N√£o autenticado
        '404':
          description: Reposit√≥rio n√£o encontrado
        '500':
          description: Erro no servidor

  # ===== ADMIN - ARTIFACTS =====
  /api/v1/admin/artifacts/{externalId}:
    get:
      summary: Busca artefato por ID
      description: Retorna os metadados de um artefato espec√≠fico pelo UUID
      tags:
        - Admin - Artifacts
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: externalId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: UUID do artefato
      responses:
        '200':
          description: Artefato encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Artifact'
        '401':
          description: N√£o autenticado
        '404':
          description: Artefato n√£o encontrado
        '500':
          description: Erro no servidor

  # ===== ADMIN - API KEYS =====
  # CONECTADO NO MAINROUTER: N√ÉO (controller existe mas n√£o est√° montado)
  /api/v1/admin/api-keys:
    get:
      summary: Lista as API Keys do usu√°rio
      description: Retorna todas as chaves de API do usu√°rio autenticado
      tags:
        - Admin - API Keys
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Lista de API Keys
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    prefix:
                      type: string
                    last_used_at:
                      type: string
                      format: date-time
                    created_at:
                      type: string
                      format: date-time
        '401':
          description: N√£o autenticado
    
    post:
      summary: Cria uma nova API Key
      description: Gera uma nova chave de API para o usu√°rio autenticado
      tags:
        - Admin - API Keys
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  example: "minha-chave-de-upload"
                  description: Nome descritivo para a chave
      responses:
        '200':
          description: Chave criada com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Chave forjada com sucesso! Guarda bem, ela n√£o aparece de novo."
                  name:
                    type: string
                  api_key:
                    type: string
                    description: Chave completa - salve em local seguro!
        '400':
          description: Nome da chave n√£o fornecido
        '401':
          description: N√£o autenticado
        '500':
          description: Erro ao gerar a chave

  /api/v1/admin/api-keys/{id}:
    delete:
      summary: Revoga uma API Key
      description: Deleta/revoga uma chave de API espec√≠fica
      tags:
        - Admin - API Keys
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID da chave a ser revogada
      responses:
        '200':
          description: Chave revogada com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Chave incinerada com sucesso!"
        '400':
          description: ID inv√°lido
        '401':
          description: N√£o autenticado
        '404':
          description: Chave n√£o encontrada

  # ===== ADMIN - REPOSITORIES =====
  # CONECTADO NO MAINROUTER: N√ÉO (controller existe mas n√£o est√° montado)
  /api/v1/admin/repositories:
    get:
      summary: Lista todos os reposit√≥rios
      description: |
        Retorna uma lista paginada de reposit√≥rios.
        **Controller implementado** mas n√£o montado no MainRouter.
      tags:
        - Admin - Repositories
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
          description: N√∫mero de itens por p√°gina
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Offset para pagina√ß√£o
      responses:
        '200':
          description: Lista de reposit√≥rios
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Repository'
                  total:
                    type: integer
                  limit:
                    type: integer
                  offset:
                    type: integer
        '401':
          description: N√£o autenticado
        '500':
          description: Erro no servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    
    post:
      summary: Cria um novo reposit√≥rio
      description: |
        Cria um reposit√≥rio para armazenar pacotes.
        **Controller implementado** mas n√£o montado no MainRouter.
      tags:
        - Admin - Repositories
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - namespace
              properties:
                name:
                  type: string
                  example: "my-repo"
                namespace:
                  type: string
                  example: "@sambura"
                is_public:
                  type: boolean
                  default: false
      responses:
        '200':
          description: Reposit√≥rio criado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Repository'
        '400':
          description: Dados inv√°lidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: N√£o autenticado
        '500':
          description: Erro no servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ===== ADMIN - PACKAGES =====
  # CONECTADO NO MAINROUTER: N√ÉO (controller existe mas n√£o est√° montado)
  /api/v1/admin/packages:
    get:
      summary: Lista todos os pacotes do sistema
      description: |
        Retorna uma lista global de todos os pacotes.
        **Controller implementado** mas n√£o montado no MainRouter.
      tags:
        - Admin - Packages
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: Lista de pacotes
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Package'
                  total:
                    type: integer
                  limit:
                    type: integer
                  offset:
                    type: integer
        '401':
          description: N√£o autenticado
        '500':
          description: Erro no servidor

  /api/v1/admin/repositories/{repoName}/packages:
    get:
      summary: Lista pacotes de um reposit√≥rio espec√≠fico
      description: |
        Retorna todos os pacotes de um reposit√≥rio.
        **Controller implementado** mas n√£o montado no MainRouter.
      tags:
        - Admin - Packages
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: repoName
          in: path
          required: true
          schema:
            type: string
          description: Nome do reposit√≥rio
          example: "my-repo"
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: Lista de pacotes do reposit√≥rio
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Package'
        '401':
          description: N√£o autenticado
        '404':
          description: Reposit√≥rio n√£o encontrado
        '500':
          description: Erro no servidor

  # ===== UPLOAD =====
  # CONECTADO NO MAINROUTER: N√ÉO (controller existe mas n√£o est√° montado)
  /api/v1/upload:
    post:
      summary: Faz upload de um artefato (POST)
      description: |
        Upload de artefatos via multipart/form-data ou JSON (npm publish).
        **Controller implementado** mas n√£o montado no MainRouter.
        Suporta dois formatos:
        - **Multipart/Form-Data**: Upload direto de arquivo .tgz
        - **JSON**: Formato npm publish com base64 attachment
      tags:
        - Upload
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
                - package
                - version
              properties:
                file:
                  type: string
                  format: binary
                  description: Arquivo .tgz do pacote
                package:
                  type: string
                  example: "@sambura/core"
                version:
                  type: string
                  example: "1.0.0"
                repository:
                  type: string
                  default: "default"
                  example: "my-repo"
      responses:
        '200':
          description: Artefato enviado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Artefato no ninho! üöÄ"
        '400':
          description: Dados incompletos ou formato inv√°lido
        '401':
          description: N√£o autenticado
        '500':
          description: Erro no processamento

    put:
      summary: Faz upload de um artefato (PUT)
      description: |
        Upload de artefatos via multipart/form-data ou JSON (npm publish) usando m√©todo PUT.
        **Controller implementado** mas n√£o montado no MainRouter.
        Compat√≠vel com `npm publish`.
      tags:
        - Upload
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
                - package
                - version
              properties:
                file:
                  type: string
                  format: binary
                  description: Arquivo .tgz do pacote
                package:
                  type: string
                  example: "@sambura/core"
                version:
                  type: string
                  example: "1.0.0"
                repository:
                  type: string
                  default: "default"
                  example: "my-repo"
          application/json:
            schema:
              type: object
              description: Payload do npm publish (formato packument com _attachments)
      responses:
        '200':
          description: Artefato enviado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Artefato no ninho! üöÄ"
        '400':
          description: Dados incompletos ou formato inv√°lido
        '401':
          description: N√£o autenticado
        '403':
          description: Vers√£o j√° publicada (n√£o pode sobrescrever)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "forbidden"
                  reason:
                    type: string
                    example: "You cannot publish over the previously published versions."
        '500':
          description: Erro no processamento

  # ===== NPM - METADATA E PUBLISH =====
  # CONECTADO NO MAINROUTER: N√ÉO (controller existe mas n√£o est√° montado)
  /api/v1/npm/private-repo/{packageName}:
    get:
      summary: Obt√©m metadados do pacote NPM
      description: |
        Retorna metadados no formato do NPM Registry.
        **Controller implementado** mas n√£o montado no MainRouter.
        Endpoint consultado pelo NPM CLI antes de publicar ou instalar.
      tags:
        - NPM
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: packageName
          in: path
          required: true
          schema:
            type: string
          description: Nome do pacote (pode conter escopo com @)
          example: "@sambura/core"
      responses:
        '200':
          description: Metadados do pacote
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NPMMetadata'
        '401':
          description: N√£o autenticado
        '404':
          description: Pacote n√£o encontrado
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Not found"

  # ===== RESUMO DO ESTADO ATUAL =====
  # 
  # ROTAS CONECTADAS E FUNCIONAIS no MainRouter:
  # ‚úì POST /api/v1/auth/register (requer autentica√ß√£o)
  # ‚úì POST /api/v1/auth/login (p√∫blico)
  # ‚úì GET  /api/v1/system/* (p√∫blico - SystemController com sub-rotas)
  #
  # CONTROLLERS IMPLEMENTADOS MAS N√ÉO CONECTADOS:
  # ‚úó ApiKeyController - Gerenciamento de API Keys
  # ‚úó RepositoryController - CRUD de reposit√≥rios  
  # ‚úó PackageController - Listagem e metadados NPM
  # ‚úó ArtifactController - Resolu√ß√£o e download
  # ‚úó BlobController - Download de blobs
  # ‚úó UploadController - Upload multipart/npm publish
  #
  # PR√ìXIMOS PASSOS:
  # 1. Edite lib/infrastructure/api/routes/main_router.dart
  # 2. Injete os controllers faltantes no construtor
  # 3. Monte as rotas usando .mount() ou criando handlers
  # 4. Teste cada endpoint ap√≥s conectar
  #
  # Exemplo de montagem:
  # protectedRouter.mount('/admin/api-keys', _apiKeyController.router.call);
  # protectedRouter.mount('/admin/repositories', _repositoryController.router.call);
  # protectedRouter.post('/upload', _uploadController.handle);
  # protectedRouter.put('/upload', _uploadController.handle);

    get:
      summary: Resolve a localiza√ß√£o de um artefato
      description: Busca artefato no banco ou faz proxy do NPM Registry
      tags:
        - Artifacts
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: repositoryName
          in: path
          required: true
          schema:
            type: string
          example: "my-repo"
          description: Nome do reposit√≥rio
        - name: packageName
          in: path
          required: true
          schema:
            type: string
          example: "@sambura/core"
          description: Nome do pacote (pode incluir namespace)
        - name: version
          in: path
          required: true
          schema:
            type: string
          example: "1.0.0"
          description: Vers√£o do pacote
      responses:
        '200':
          description: Artefato encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Artifact'
        '401':
          description: N√£o autenticado
        '404':
          description: Artefato n√£o encontrado
        '500':
          description: Erro no servidor

  /api/v1/public/download/{namespace}/{name}/{version}:
    get:
      summary: Download de artefato
      description: Faz o download do arquivo bin√°rio do artefato
      tags:
        - Artifacts
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          schema:
            type: string
          example: "@sambura"
          description: Namespace do pacote (escopo)
        - name: name
          in: path
          required: true
          schema:
            type: string
          example: "core"
          description: Nome do pacote sem namespace
        - name: version
          in: path
          required: true
          schema:
            type: string
          example: "1.0.0"
          description: Vers√£o do pacote
      responses:
        '200':
          description: Download iniciado
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
          headers:
            Content-Type:
              schema:
                type: string
            Content-Length:
              schema:
                type: integer
            Content-Disposition:
              schema:
                type: string
        '401':
          description: N√£o autenticado
        '404':
          description: Artefato n√£o encontrado
        '500':
          description: Erro no servidor

  /api/v1/public/blobs/{hash}:
    get:
      summary: Download de blob por hash
      description: Faz o download direto de um blob bin√°rio pelo seu hash
      tags:
        - Blobs
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: hash
          in: path
          required: true
          schema:
            type: string
          description: Hash SHA-256 do blob
          example: "a3b2c1d4e5f6..."
      responses:
        '200':
          description: Download do blob
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
          headers:
            Content-Type:
              schema:
                type: string
            Content-Length:
              schema:
                type: integer
            Content-Disposition:
              schema:
                type: string
        '401':
          description: N√£o autenticado
        '404':
          description: Blob n√£o encontrado
        '500':
          description: Erro no servidor

  /api/v1/public/npm/{repo}/{packageName}:
    get:
      summary: Obt√©m metadados do pacote NPM (p√∫blico)
      description: Retorna metadados no formato do NPM Registry sem autentica√ß√£o
      tags:
        - NPM
      parameters:
        - name: repo
          in: path
          required: true
          schema:
            type: string
          example: "my-repo"
        - name: packageName
          in: path
          required: true
          schema:
            type: string
          description: Nome do pacote (pode conter escopo com @)
          example: "@sambura/core"
      responses:
        '200':
          description: Metadados do pacote
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NPMMetadata'
        '404':
          description: Pacote n√£o encontrado
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Package not found"

  # ===== SWAGGER UI =====
  /api/v1/public/docs:
    get:
      summary: Documenta√ß√£o Swagger UI
      description: Interface gr√°fica da documenta√ß√£o da API
      tags:
        - Docs
      responses:
        '200':
          description: P√°gina HTML do Swagger UI

  # ===== NPM COMPATIBLE (Autenticado) =====
  /api/v1/npm/{repo}/-/v1/search:
    get:
      summary: Busca pacotes no NPM (npm search)
      description: |
        Encaminha a consulta para o registro oficial do NPM e retorna resultados filtrados.
        Compat√≠vel com `npm search` e ferramentas que usam a API de search do NPM.
      tags:
        - NPM
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: repo
          in: path
          required: true
          schema:
            type: string
          example: "my-repo"
          description: Nome do reposit√≥rio
        - name: text
          in: query
          schema:
            type: string
          description: Termo de busca
          example: "lodash"
        - name: size
          in: query
          schema:
            type: integer
            default: 20
          description: N√∫mero de resultados
        - name: from
          in: query
          schema:
            type: integer
            default: 0
          description: Offset para pagina√ß√£o
      responses:
        '200':
          description: Resultados da busca
          content:
            application/json:
              schema:
                type: object
                properties:
                  objects:
                    type: array
                    items:
                      type: object
                      properties:
                        package:
                          type: object
                          properties:
                            name:
                              type: string
                            version:
                              type: string
                            description:
                              type: string
                  total:
                    type: integer
        '401':
          description: N√£o autenticado
        '500':
          description: Erro no servidor

  /api/v1/npm/{repo}/{packageName}:
    get:
      summary: Obt√©m metadados do pacote NPM (autenticado)
      description: Retorna metadados no formato do NPM Registry para compatibilidade com clientes NPM
      tags:
        - NPM
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: repo
          in: path
          required: true
          schema:
            type: string
          example: "my-repo"
        - name: packageName
          in: path
          required: true
          schema:
            type: string
          description: Nome do pacote (pode conter escopo com @)
          example: "@sambura/core"
      responses:
        '200':
          description: Metadados do pacote
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NPMMetadata'
        '401':
          description: N√£o autenticado
        '404':
          description: Pacote n√£o encontrado
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Package not found"

    put:
      summary: Publica/atualiza um pacote NPM
      description: Endpoint compat√≠vel com `npm publish` para publicar pacotes
      tags:
        - NPM
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: repo
          in: path
          required: true
          schema:
            type: string
          example: "my-repo"
        - name: packageName
          in: path
          required: true
          schema:
            type: string
          description: Nome do pacote (pode conter escopo com @)
          example: "@sambura/core"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: Payload do npm publish (formato packument)
      responses:
        '200':
          description: Pacote publicado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Artefato no ninho! üöÄ"
        '400':
          description: Dados inv√°lidos
        '401':
          description: N√£o autenticado
        '500':
          description: Erro no servidor

  # ===== ROUTES ALTERNATIVAS AUTENTICADAS =====
  /api/v1/download/{repo}/{name}/{version}:
    get:
      summary: Download alternativo de artefato
      description: Rota alternativa para download de artefatos com autentica√ß√£o
      tags:
        - Artifacts
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: repo
          in: path
          required: true
          schema:
            type: string
          example: "my-repo"
        - name: name
          in: path
          required: true
          schema:
            type: string
          example: "@sambura/core"
          description: Nome do pacote (pode incluir namespace)
        - name: version
          in: path
          required: true
          schema:
            type: string
          example: "1.0.0"
      responses:
        '200':
          description: Download iniciado
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '401':
          description: N√£o autenticado
        '404':
          description: Artefato n√£o encontrado

  /api/v1/resolve/{repository}/{package}/{version}:
    get:
      summary: Resolve artefato (rota alternativa)
      description: Rota alternativa para resolu√ß√£o de artefatos
      tags:
        - Artifacts
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: repository
          in: path
          required: true
          schema:
            type: string
          example: "my-repo"
        - name: package
          in: path
          required: true
          schema:
            type: string
          example: "@sambura/core"
        - name: version
          in: path
          required: true
          schema:
            type: string
          example: "1.0.0"
      responses:
        '200':
          description: Artefato encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Artifact'
        '401':
          description: N√£o autenticado
        '404':
          description: Artefato n√£o encontrado

  /api/v1/upload:
    post:
      summary: Upload de artefato (POST)
      description: Upload de artefatos via multipart/form-data
      tags:
        - Upload
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
                - package
                - version
              properties:
                file:
                  type: string
                  format: binary
                  description: Arquivo .tgz do pacote
                package:
                  type: string
                  example: "@sambura/core"
                version:
                  type: string
                  example: "1.0.0"
                repository:
                  type: string
                  default: "default"
                  example: "my-repo"
      responses:
        '200':
          description: Artefato enviado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Artefato no ninho! üöÄ"
        '400':
          description: Dados incompletos ou formato inv√°lido
        '401':
          description: N√£o autenticado
        '500':
          description: Erro no processamento

    put:
      summary: Upload de artefato (PUT)
      description: Upload de artefatos via multipart/form-data (m√©todo PUT)
      tags:
        - Upload
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
                - package
                - version
              properties:
                file:
                  type: string
                  format: binary
                  description: Arquivo .tgz do pacote
                package:
                  type: string
                  example: "@sambura/core"
                version:
                  type: string
                  example: "1.0.0"
                repository:
                  type: string
                  default: "default"
                  example: "my-repo"
      responses:
        '200':
          description: Artefato enviado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Artefato no ninho! üöÄ"
        '400':
          description: Dados incompletos ou formato inv√°lido
        '401':
          description: N√£o autenticado
        '500':
          description: Erro no processamento